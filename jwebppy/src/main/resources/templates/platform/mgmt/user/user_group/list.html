<!DOCTYPE html>
<html
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{platform/layout/common/index}">

<th:block layout:fragment="content">
<div class="ui dividing header">
  User Group
  <div class="sub header">Users can be classified according to regions, sales divisions, types of customers so on.</div>
</div>
<div class="ui segment">
	<form id="FORM_search" class="ui form" autocomplete="off" onsubmit="return false;">
	<input type="hidden" id="pageNumber" name="pageNumber"  th:value="${pageNumber}"/>
	<input type="hidden" id="rowPerPage" name="rowPerPage"  th:value="${rowPerPage}"/>
	<div class="fields">	
		<div class="twelve wide field">
			<div class="ui icon input">
				<input type="text" id="query" name="query" placeholder="Search"> <i class="search icon"></i>
			</div>
		</div>
		<div class="four wide field">
			<div id="BTN_search" class="ui teal button"><i class="search icon"></i> Search</div>
			<div class="ui button" onclick="document.location.reload()"><i class="undo icon"></i> Reset</div>
		</div>
	</div>
	</form>
	<div class="ui divider"></div>
	<div class="ui one column grid">
		<div class="column">
			<div id="BTN_new" class="ui teal button"><i class="plus icon"></i> New</div>
			<div id="BTN_delete" class="ui teal button"><i class="minus icon"></i> Delete</div>
		</div>
	</div>	
	<div class="ui divider"></div>
	<form id="FORM_write">
	<div id="TBL_list"></div>
	</form>
</div>
<script>
let listTable;

$(document).ready(function() {
	listTable = new JpUiTable($("#TBL_list"));
	listTable.settings = {
			ajax: {
				url: "/platform/mgmt/user/user_group/list/layout",
				form: $("#FORM_search")
			},
			onClickPageNumber: function(pageNumber)
			{
				$("#pageNumber").val(pageNumber);
				doSearch();
			},
			onClickDataKey: function(element, key, row, column, rowIndex, columnIndex)
			{
				let url = null;
				
				if (columnIndex == 1)
				{
					url = "/platform/mgmt/user/user_group/view?ugSeq=" + JpUtilsString.trimToEmpty(key);
				}
				else if (columnIndex == 6)
				{
					url = "/platform/mgmt/conn_resource/view?scrSeq=" + JpUtilsString.trimToEmpty(key);
				}
				
				if (JpUtilsString.isNotEmpty(url))
				{
					JpUiPopup.open({
						url: url
					});
				};
			}
	};

	$("#BTN_search").on("click", function() {
		doSearch();
	});

	$("#query").on("keydown", function(event) {
		if (event.keyCode==13)
		{
			doSearch();
		}
	});
	
	$("#BTN_new").on("click", function() {
		JpUiPopup.open({
			url: "/platform/mgmt/user/user_group/write"
		});
	});
	
	$("#BTN_delete").on("click", function() {
		if (listTable.getCheckedCount() == 0)
		{
			JpUiDimmer.alert("Please choose targets.");
			return;
		};
		
		JpUiDimmer.confirm("Do you want to delete?", function() {
			JpUtilsAjax.post({
				url: "/platform/mgmt/user/user_group/delete",
				data: $("#FORM_write").serialize(),
				success: function(data, textStatus, jqXHR)
				{
					listTable.load();
				}
			});				
		});
	});

	doSearch();
});

function doSearch()
{
	listTable.load();
};
</script>

</th:block>
</html>
