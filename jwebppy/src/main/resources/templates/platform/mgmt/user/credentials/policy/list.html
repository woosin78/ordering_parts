<!DOCTYPE html>
<html
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{platform/layout/common/index}">

<th:block layout:fragment="content">
<div class="ui dividing header">
  Credentials Policy
  <div class="sub header">You can manage credentials policy such as username and password.</div>
</div>
<div class="ui segment">
	<form id="FORM_search" class="ui form" autocomplete="off" onsubmit="return false;">
	<input type="hidden" id="pageNumber" name="pageNumber"  th:value="${pageNumber}"/>
	<input type="hidden" id="rowPerPage" name="rowPerPage"  th:value="${rowPerPage}"/>
	<div class="fields">	
		<div class="twelve wide field">
			<div class="ui icon input">
				<input type="text" id="query" name="query" placeholder="Search"> <i class="search icon"></i>
			</div>
		</div>
		<div class="four wide field">
			<div id="BTN_search" class="ui teal button"><i class="search icon"></i> Search</div>
			<div class="ui button" onclick="document.location.reload()"><i class="undo icon"></i> Reset</div>
		</div>
	</div>		
	<div class="ui divider"></div>
	<div class="ui one column grid">
		<div class="column">
			<div id="BTN_deleteUser" class="ui teal button"><i class="minus icon"></i> Delete</div>
		</div>
	</div>	
	<div id="TBL_list"></div>
	</form>
</div>
<script type="application/javascript">
	$(document).ready(function() {
		let listTable = new JpUiTable($("#TBL_list"));
		listTable.settings = {
				ajax: {
					url: JpUtilsPath.url("/platform/mgmt/user/credentials/policy/list/data"),
					form: $("#FORM_search")
				},
				onClickPageNumber: function(pageNumber)
				{
					$("#pageNumber").val(pageNumber);
					doSearch();
				},
				checkbox: {
					onChange: function() {
						let name = $(this).attr("name");
						
						if (name == "fgUse" || name == "fgDefault")
						{
							let cpSeq = $(this).closest("tr").find("input:checkbox[name=cpSeq]").val();							
							let path = (name == "fgUse") ? "use" : "default";
							let value = ($(this).is(":checked")) ? $(this).val() : "";
							
							JpUtilsAjax.post({
								url: JpUtilsPath.url("/platform/mgmt/user/credentials/policy/modify/" + path),
								data: {cpSeq: cpSeq, value: value},
								success: function(data, textStatus, jqXHR)
								{
									listTable.load();
								}
							});							
						}
					}
				}
		};

		$("#BTN_search").on("click", function() {
			doSearch();
		});
		
		$("#query").on("keydown", function(event) {
			if (event.keyCode==13)
			{
				doSearch();
			}
		});
		
		function doSearch()
		{
			listTable.load();
		};	
		
		doSearch();
	});
</script>

</th:block>
</html>
