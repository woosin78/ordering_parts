<!DOCTYPE html>
<html
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{portal/layout/popup/index}">

<th:block layout:fragment="content">
	<div class="block-header">
		<div class="block-title" th:text="#{DCP_T_SIMULATION_ERROR REPORT}"></div>
		<div class="block-button-area">
			<button id="BTN_download" type="button">[[#{DCP_B_DOWNLOAD}]]</button>
		</div>		
	</div>
	
	<div id="AREA_grid" class="flex-grow grid-area">
		<table id="TBL_grid" class="order-column stripe compact"></table>
	</div>
	
	<script type="application/javascript">
	$(function(){
		$tableObj = $("#TBL_grid").DataTable({
			select: true,// row 선택 기능 켬
			ordering: false,// 정렬 기능 켬
			scrollY: 100,
			fixedColumns: { leftColumns: 1 },// 컬럼 고정 켬. (왼쪽 2개 컬럼 고정)
			columns : [
				{name: "materialNo", data: "materialNo", title: "[[#{DCP_L_ORDER_PART_NO}]]"},//Parts No.
				{
					name: "nonExist",
					title: "[[#{DCP_L_SIMULATION_ERROR_NOT_EXIST}]]",
					render: function(data, type, row)
					{
						if (row.errorType == "NON_EXIST")
						{
							return "X";
						}
						
						return "";
					}
				},
				{
					name: "wrongDivision",
					title: "[[#{DCP_L_SIMULATION_ERROR_WRONG_DIVISION}]]",
					render: function(data, type, row)
					{
						if (row.errorType == "WRONG_DIVISION")
						{
							return "X";
						}
						
						return "";
					}
				},			
				{
					name: "nonPurchase",
					title: "[[#{DCP_L_SIMULATION_ERROR_NOT_SERVICEABLE}]]",
					render: function(data, type, row)
					{
						if (row.errorType == "NON_PURCHASE")
						{
							return "X";
						}
						
						return "";
					}
				},				
				{name: "errorCode", data: "errorCode", title: "[[#{DCP_L_SIMULATION_ERROR_CODE}]]"},//Error Code
				{name: "errorMessage", data: "errorMessage", title: "[[#{DCP_L_SIMULATION_ERROR_MSG}]]"}//Text	
			],
			data: opener.errorOrderItems,
			drawCallback: function(settings)
			{
				ProgressBar.hide();
			}
		});	
		
		// window 리사이즈시 그리드 높이 다시 맞춤. (그리드의 parent 요소의 높이에 맞춤)
		installDataTableResizer($tableObj, $("#AREA_grid"));
		
		// dataTable 버그 수정.
		installDataTableBugFix("TBL_grid");
		
		$("#BTN_download").on("click", function() {
			var gridFileDownload = new GridFileDownload($tableObj);
			gridFileDownload.fileName = "error_report";
			gridFileDownload.excelDownload();
		});	
	});
	</script>	
</th:block>