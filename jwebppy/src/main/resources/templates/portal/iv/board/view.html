<!DOCTYPE html>
<html
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{portal/layout/iv/hq/parts/common/index}">

<th:block layout:fragment="content">
<script th:src="@{/editor_html5/js/xfe_main.js}"></script>

<div class="block-header">
	<div class="block-title" th:text="#{HQP_T_NOTICE}"></div>
	<div class="block-button-area">
		<button id="BTN_modify" type="button" th:text="#{HQP_B_MODIFY}"></button>
		<button id="BTN_back" type="button" th:text="#{HQP_B_BACK}"></button>
	</div>	
</div>	
<div id="boardViwer" class="condition-area">
<table class="condition table-fixed">
	<tbody>
		<tr>
			<th><span th:text="#{HQP_L_TITLE}"></span></th>
			<td th:text="${boardContent.title}" colspan="3"/>
		</tr>
		<tr>
			<th th:text="#{HQP_L_WRITER}"></th>
			<td th:text="${boardContent.writer}"></td>
			<th th:text="#{HQP_L_REG_DATE}"></th>
			<td th:text="${boardContent.displayRegDate}"></td>
			<th th:text="#{HQP_L_VIEWS}"></th>
			<td th:text="${boardContent.views}"></td>
		</tr>
		<tr>
			<td colspan="6"><div id="xfe"></div></td>
		</tr>
		<tr>
			<th th:text="#{HQP_L_ATTACHMENT}"/>
			<td colspan="5">
				<div th:each="uploadFileList : ${boardContent.uploadFileLists}">
					<a class="link" th:text="${uploadFileList.fullOriginName}" th:downloadKey="${uploadFileList.downloadKey}"></a><div class='split2'></div><span th:text="${uploadFileList.displayFileSize}"></span>
				</div>
			</td>
		</tr>
	</tbody>
</table>
</div>
<form id="FORM_search" th:action="|${BASE_PATH}/board/list|" th:object="${boardContentSearch}">
<input type="hidden" name="bSeq" th:value="${bSeq}"/>
<input type="hidden" name="bcSeq" th:value="${boardContent?.bcSeq}"/>
<input type="hidden" name="title" th:value="${title}"/>
<input type="hidden" name="writer" th:value="${writer}"/>
<input type="hidden" name="fromRegDate" th:value="${fromRegDate}"/>
<input type="hidden" name="toRegDate" th:value="${toRegDate}"/>
<input type="hidden" name="pageNumber" th:value="${pageNumber}"/>
</form>
<input type="hidden" id="htmlContent" th:value="${boardContent.htmlContent}"/>
<script>
$(window).on("load", function() {
	ProgressBar.hide();
	
	initBoardViwer($("#boardViwer"), $("#xfe"));
});

function initBoardViwer($area, $content)
{
	installBoardViewResizer($area, $content);
	
	$(window).on("resize", $.debounce(100, function(e){
		installBoardViewResizer($area, $content);
	}));
};

function installBoardViewResizer($area, $content)
{
	let height = 0;
	
	$.each($("body").children(":not(script)").not($area), function(index, element) {
		if (!$(element).is(":visible"))
		{
			return true;
		};
		
		//console.log($(element).prop("tagName") + ":" + $(element).prop("class") + ":" + $(element).outerHeight(true));
		height += $(element).outerHeight(true);
	});
	
	let bodyHeight = $("body").height();
	let h1 = $area.outerHeight(true) - $content.outerHeight(true);//게시글 영역 외 height
	
	$content.height(bodyHeight - height - h1);
	xfe.setHeight($content.height() + "px");
};


$("#BTN_modify").on("click", function() {
	$("#FORM_search").attr("action", "[[${BASE_PATH}]]/board/write");
	$("#FORM_search").submit();
});

$("#BTN_back").on("click", function() {
	$("#FORM_search").submit();
});

/*
 * 에디터 생성.
 * 
 * basePath : 에디터 모듈이 있는 폴더의 Url 경로를 적어줍니다. (필수)
 * width : 에디터의 너비
 * height : 에디터의 높이
 * onLoad : 에디터 초기 로드 이벤트				 
 */	
let xfe = new XFE({
	basePath: "[[@{/editor_html5}]]",
	width: "100%",
	viewMode: true,
    viewModeOptions: {
    	borderWidth: "0px"
    },
	onLoad: function() {
		xfe.setBodyValue($("#htmlContent").val());
	}
});
	
xfe.render("xfe");

$("a[downloadKey]").on("click", function() {					
	PortalFileDownload.download($(this).attr("downloadKey"));
});	
</script>
</th:block>								