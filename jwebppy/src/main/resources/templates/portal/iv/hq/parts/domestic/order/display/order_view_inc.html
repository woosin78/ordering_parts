<!DOCTYPE html>
<html
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

	<script th:src="@{/portal/js/portal.utils.grid.download.js}"></script>

	<div class="block-header">
		<div class="block-title" th:text="#{HQPD_T_ORDER_DETAIL}"></div>
		<div id="BTN_search" class="block-button-area">
			<button id="BTN_pdfDownload" type="button" th:text="#{HQPD_B_PDF_DOWNLOAD}"></button><!-- PDF Download -->
			<button id="BTN_back" type="button" th:text="#{HQPD_B_BACK}"></button><!-- Back -->
		</div>
	</div>
	
	<div class="condition-area">
	<table class="condition table-fixed">
		<tbody>
			<tr>
				<th th:text="#{HQPD_L_ORDER_TYPE}"></th>
				<td id="KONDA_TEXT"></td>
				<th th:text="#{HQPD_L_SHIP_TO_PARTY}">
				<td id="KUNAG_NAME"></td>
			</tr>
			<tr>
				<th th:text="#{HQPD_L_PO_NO}"></th>
				<td id="BSTNK"></td>
				<th th:text="#{HQPD_L_SHIPPING_INFO}"></th>
				<td id="VSBED_TX"></td>
			</tr>
			<tr>
				<th th:text="#{HQPD_L_RDD}"></th>
				<td id="VDATU"></td>
				<th th:text="#{HQPD_L_COMPLETE_DELIVERY}"></th>
				<td id="COMPLETE_DELIVERY"></td>
			</tr>
			<tr>
				<th th:text="#{HQPD_L_REMARKS}"></th>				
				<td colspan="3" id="remark"></td>
			</tr>
		</tbody>
	</table>
	</div>
	<div class="split-row"></div>
	
	<div class="grid-info">
		<div class="block-button-area">
			<button id="BTN_download" th:text="#{HQPD_B_DOWNLOAD}"></button>
		</div>	
		<div class="grid-total">
			<span th:text="#{HQPD_T_TOTAL_AMOUNT}"></span>
			<div class="split"></div>
			<span class="total-number" id="NETWR"></span>
			<div class="split2"></div>
			<span th:text="#{HQPD_T_CREDIT}"></span>
			<div class="split"></div>
			<span class="total-number" id="CREDIT"></span>
			<div class="split2"></div>
			<span th:text="#{HQPD_T_ESTIMATE_WEIGHT}"></span>
			<div class="split"></div>
			<span class="total-number" id="TOTAL_WEIGHT"></span>
		</div>
	</div>
	
	<div id="AREA_grid" class="flex-grow grid-area">
		<table id="TBL_grid" class="order-column stripe compact"></table>
	</div>
	
	<form id="FORM_search" name="FORM_search">
		<input type="hidden" name="pDocType" th:value="${pDocType}">
		<input type="hidden" name="pOrderType" th:value="${pOrderType}">
		<input type="hidden" name="pOrderNo" th:value="${pOrderNo}">
		<input type="hidden" name="pPoNo" th:value="${pPoNo}">
		<input type="hidden" name="pFromDate" th:value="${pFromDate}">
		<input type="hidden" name="pToDate" th:value="${pToDate}">
	</form>
	
<script>

//화면중 일부 area 를 채우는 그리드 예제. 상위 div #sample-grid-area 영역을 100% 채움.
//컬럼 width 자동. scroller 자동.
//고정된 맵 데이터 사용. 페이지 생성시 데이터 넘겨서 그리드 만드는 방식

$(function(){
	let customerType = "[[${erpUserInfo.get("TYPE")}]]";
	
	$.ajax({
		url: "/portal/iv/hq/parts/domestic/order/display/order_view/data",		
		data: {"orderNo": "[[${orderNo}]]"},
	    success: function(response, textStatus, jqXHR) 
	    {
	    	let result = response.RESULT;

	    	let mainHeadResult = result.mainHeadResult;
	    	let general = result.general;	    	
	    	let item = result.item;
	    	
	    	$.each(item, function(key, value) {
	    		this.VBELN = "[[${orderNo}]]";
	    	});
	    	
	    	$("#KONDA_TEXT").html(mainHeadResult.KONDA_TEXT);
	    	$("#KUNAG_NAME").html(mainHeadResult.KUNAG_NAME + " " + mainHeadResult.KUNAG_STREET);
	    	$("#BSTNK").html(general.BSTNK);
	    	$("#VSBED_TX").html(general.VSBED_TX);
	    	$("#VDATU").html(general.VDATU);
	    	$("#COMPLETE_DELIVERY").html( (general.COMPLETE_DELIVERY == "X") ? "Y" : "N" );
	    	$("#remark").html(result.remark);
	    	$("#NETWR").html(mainHeadResult.NETWR + " " + mainHeadResult.WAERK);
	    	$("#CREDIT").html(mainHeadResult.CREDIT + " " + mainHeadResult.CREDIT_WAERK);
	    	$("#TOTAL_WEIGHT").html(mainHeadResult.TOTAL_WEIGHT + " " + mainHeadResult.GEWEI);
	    	
	    	$tableObj = $("#TBL_grid").DataTable({
	    		select: {
	    			selector: "td:not(.noselect)"// noselect class 컬럼은 select 하지 않도록 한다. (input과 충돌 발생)
	    	    },
	    		ordering: true,// 정렬 기능 켬
	    		scrollY: 100,
	    		columns : [
	    			{data: "VBELN", title: "[[#{HQPD_L_ORDER_NO}]]"},//Order No.
	    			{data: "ITEM", title: "[[#{HQPD_L_LINE_ITEM}]]"},//Item
	    			{data: "MATERIAL_ENT", title: "[[#{HQPD_L_ORDER_PART_NO}]]"},//Order Part No.
	    			{data: "MATERIAL", title: "[[#{HQPD_L_SUPPLY_PART_NO}]]"},//Supply Part No
	    			{data: "MATERIAL_TEXT", title: "[[#{HQPD_L_DESCRIPTION}]]"},//Description
	    			{data: "REQ_QTY", title: "[[#{HQPD_L_REQ_QTY}]]"},//Req Qty
	    			{data: "LOT_QTY", title: "[[#{HQPD_L_SALES_LOT}]]"},//Sales Lot
	    			{data: "UOM", title: "[[#{HQPD_L_UOM}]]"},//UoM
	    			{data: "NET_PRICE", title: "[[#{HQPD_L_NET_PRICE}]]", className: "right"},//Net Price
	    			{data: "NET_VALUE", title: "[[#{HQPD_L_NET_VALUE}]]", className: "right"},//Net Value
	    			{data: "AVAILABILITY", title: "[[#{HQPD_L_AVAILABILITY}]]"}//Available
	    		],
	    		columnDefs: [
	    			{ className: "left", targets: "_all" }
	    		],
	    		data: item,
	    		initComplete: function() {
	    			ProgressBar.hide();
	    		}	    		
	    	});
	    	
	    	// Datatable grid 초기 설정 셋업
	    	initGridTable($tableObj);	
	    }
	});

	$("#BTN_pdfDownload").on("click", function() {
		document.location.href = "/portal/iv/hq/parts/domestic/order/display/pdf_download?orderNo=[[${orderNo}]]&mode=Y006";
	});

	$("#BTN_back").on("click", function() {
		$("#FORM_search").attr("action", "/portal/iv/hq/parts/domestic/order/display/order_list").submit();
	});

	$("#BTN_download").on("click", function() {
		let gridFileDownload = new GridFileDownload($tableObj);
		gridFileDownload.fileName = "Order_List";
		gridFileDownload.excelDownload();
	});
});
</script>	