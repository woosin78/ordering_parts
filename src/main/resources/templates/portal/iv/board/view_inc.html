<!DOCTYPE html>
<html
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
	
	<script th:src="@{/editor_html5/js/xfe_main.js}"></script>
	
	<div class="block-header">
		<div class="block-title" th:text="${boardName}"></div>
		<div class="block-button-area">
			<button id="BTN_reply" type="button" th:text="#{HQP_B_REPLY}" th:if="${board.fgUseReply == T(org.jwebppy.portal.iv.common.IvCommonVo).YES}"></button>
			<th:block th:if="${isManager} or ${boardContent.isMyContent}">
				<button id="BTN_modify" type="button" th:text="#{HQP_B_MODIFY}"></button>
				<button id="BTN_delete" type="button" th:text="#{HQP_B_DELETE}"></button>
			</th:block>
			<button id="BTN_back" type="button" th:text="#{HQP_B_BACK}" th:if="${fgFrom ne 'M'}"><!-- Main 에서 호출한 경우 뒤로 버튼을 보여주지 않는다 --></button>
		</div>	
	</div>
	<div id="boardViwer" class="condition-area">
	<table class="condition table-fixed">
		<tbody>
			<tr>
				<th><span th:text="#{HQP_L_TITLE}"></span></th>
				<td th:text="${boardContent.title}" colspan="5"/>
			</tr>
			<tr>
				<th th:text="#{HQP_L_WRITER}"></th>
				<td th:text="${boardContent.writer}"></td>
				<th th:text="#{HQP_L_REG_DATE}"></th>
				<td th:text="${boardContent.displayRegDate2}"></td>
				<th th:text="#{HQP_L_VIEWS}"></th>
				<td th:text="${boardContent.views}"></td>
			</tr>
			<tr>
				<td colspan="6"><div id="xfe"></div></td>
			</tr>
			<th:block th:if="${isManager eq true}">
				<tr th:style="${(board.fgSetTarget == T(org.jwebppy.portal.iv.common.IvCommonVo).YES) ? '' : 'display:none;'}">
					<th th:text="#{HQP_L_VISIBLE_TARGET}"/>
					<td colspan="5">
						<div th:each="boardContentTarget : ${boardContent.boardContentTargets}">
							<span th:text="${boardContentTarget.code}"></span><div class='split2'></div><span th:text="${boardContentTarget.description}"></span>
						</div>				
					</td>			
				</tr>
				<tr th:style="${(board.fgSetPeriod == T(org.jwebppy.portal.iv.common.IvCommonVo).YES) ? '' : 'display:none;'}">
					<th th:text="#{HQP_L_VISIBLE_PERIOD}"/>
					<td colspan="5">
						<span th:text="${boardContent.displayFromView}"></span>
						<span th:if="${not #strings.isEmpty(boardContent.displayToView)}" th:text="| - ${boardContent.displayToView}|"></span>
					</td>
				</tr>
				<tr th:style="${(board.fgSetPopup == T(org.jwebppy.portal.iv.common.IvCommonVo).YES) ? '' : 'display:none;'}">
					<th th:text="#{HQP_L_WIDTH}"/>
					<td th:text="|${boardContent.width} #{HQP_L_PLACEHOLD_PIXEL}|"></td>
					<th th:text="#{HQP_L_HEIGHT}"/>
					<td colspan="3" th:text="|${boardContent.height} #{HQP_L_PLACEHOLD_PIXEL}|"></td>
				</tr>
			</th:block>
			<tr th:style="${board?.uploadFile != null ? '' : 'display:none;'}">
				<th th:text="#{HQP_L_ATTACHMENT}"/>
				<td colspan="5">
					<div th:each="uploadFileList : ${boardContent.uploadFileLists}">
						<a class="link" th:text="${uploadFileList.fullOriginName}" th:downloadKey="${uploadFileList.downloadKey}"></a><div class='split2'></div><span th:text="${uploadFileList.displayFileSize}"></span>
					</div>
				</td>
			</tr>
		</tbody>
	</table>
	</div>
	<form id="FORM_search" th:action="|${BASE_PATH}/board/list|" th:object="${boardContentSearch}">
	<input type="hidden" name="bSeq" th:value="*{bSeq}"/>
	<input type="hidden" name="bcSeq" th:value="${boardContent.bcSeq}"/>
	<input type="hidden" name="pSeq"/>
	<input type="hidden" name="title" th:value="*{title}"/>
	<input type="hidden" name="writer" th:value="*{writer}"/>
	<input type="hidden" name="fromRegDate" th:value="*{fromRegDate}"/>
	<input type="hidden" name="toRegDate" th:value="*{toRegDate}"/>
	<input type="hidden" name="pageNumber" th:value="*{pageNumber}"/>
	</form>
	<textarea id="htmlContent" th:text="${boardContent.htmlContent}" style="display:none;"></textarea>
<script>
$(window).on("load", function() {
	ProgressBar.hide();
	
	initBoardViwer($("#boardViwer"), $("#xfe"));
});

function initBoardViwer($area, $content)
{
	installBoardViewResizer($area, $content);
	
	$(window).on("resize", $.debounce(100, function(e){
		installBoardViewResizer($area, $content);
	}));
};

function installBoardViewResizer($area, $content)
{
	let height = 0;
	
	$.each($("body").children(":not(script)").not($area), function(index, element) {
		if (!$(element).is(":visible"))
		{
			return true;
		};
		
		height += $(element).outerHeight(true);
	});
	
	let bodyHeight = $("body").height();
	let h1 = $area.outerHeight(true) - $content.outerHeight(true);//게시글 영역 외 height
	
	$content.height(bodyHeight - height - h1);
	xfe.setHeight($content.height() + "px");
};

$("#BTN_reply").on("click", function() {
	$("#FORM_search input[name=pSeq]").val("[[${boardContent.bcSeq}]]");
	
	$("#FORM_search")
		.attr("action", "[[${BASE_PATH}]]/board/write")
		.submit();
});	

$("#BTN_modify").on("click", function() {
	$("#FORM_search")
		.attr("action", "[[${BASE_PATH}]]/board/write")
		.submit();
});

$("#BTN_delete").on("click", function() {
	if (confirm("[[#{HQP_M_CONFIRM_DELETE}]]"))
	{
		JpUtilsAjax.post({
			url: "[[${BASE_PATH}]]/board/delete",
			data: {bcSeq:"[[${boardContent.bcSeq}]]", bSeq:"[[${boardContent.bSeq}]]"},
			success: function(data, textStatus, jqXHR) {
				$("#BTN_back").trigger("click");
			}		
		});		
	};
});

$("#BTN_back").on("click", function() {
	$("#FORM_search").submit();
});

/*
 * 에디터 생성.
 * 
 * basePath : 에디터 모듈이 있는 폴더의 Url 경로를 적어줍니다. (필수)
 * width : 에디터의 너비
 * height : 에디터의 높이
 * onLoad : 에디터 초기 로드 이벤트				 
 */	
let xfe = new XFE({
	basePath: "[[@{/editor_html5}]]",
	width: "100%",
	viewMode: true,
    viewModeOptions: {
    	borderWidth: "0px"
    },
	onLoad: function() {
		xfe.setBodyValue($("#htmlContent").val());
	}
});
	
xfe.render("xfe");

$("a[downloadKey]").on("click", function() {					
	PortalFileDownload.download($(this).attr("downloadKey"));
});	
</script>