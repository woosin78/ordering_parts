<!DOCTYPE html>
<html
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{portal/layout/iv/hq/parts/common/index}">
	
<th:block layout:fragment="content">
	<div class="block-header">
		<div class="block-title" th:text="#{HQP_T_AP_LIST}"></div>
		<div class="block-button-area">
			<button id="BTN_search" type="button" th:text="#{HQP_B_SEARCH}"></button>
		</div>
	</div>
	<div class="split-row"></div>
	
	<div class="condition-area">
		<table class="condition table-fixed">
			<thead>
		        <tr>
		            <th th:text="#{HQP_L_ORDER_LIMIT}" class="center"></th>
		            <th th:text="#{HQP_L_BALANCE}" class="center"></th>                        
		            <th th:text="#{HQP_L_THIS_MONTH_DEPOSIT_AMT}" class="center"></th>
		            <th th:text="#{HQP_L_ORDER_AMT_IN_PROGRESS}" class="center"></th>
		            <th th:text="#{HQP_L_DISPOSABLE_SECURITY_AMT}" class="center"></th>
		        </tr>
		     </thead>
		     <tbody>
				<tr>
					<td id="SUMMARY_1" class="right"></td>
					<td id="SUMMARY_2" class="right"></td>
					<td id="SUMMARY_3" class="right"></td>
					<td id="SUMMARY_4" class="right"></td>
					<td id="SUMMARY_5" class="right"></td>
				</tr>
			</tbody>        
		</table>
		<div class="split-row-compact"></div>
		<div class="condition-normal-sub-title warn" th:text="#{HQP_T_AP_LIST_INFO1}"></div>
		<div class="condition-normal-sub-title warn" th:text="#{HQP_T_AP_LIST_INFO2}"></div>
	</div>
	
	<div class="grid-info">
		<div class="grid-total">
			<span class="total-number" id="totalRows"></span>
		</div>
	</div>
	
	<div id="AREA_grid" class="flex-grow grid-area">		
		<table id="TBL_grid" class="order-column stripe compact"></table>
	</div>
	
<script>
let $tableObj;
$(function(){
	$tableObj = $("#TBL_grid").DataTable({
		ordering: true, 			// 정렬 기능 켬
		scrollY: 100,
		serverSide: true,
		deferLoading: false,		
		columns : [
			{data: "CRDAT", title: "[[#{HQP_L_PURCHASE_DATE}]]"},				
			{data: "ENDAT", title: "[[#{HQP_L_PAYMENT_DUE_DATE}]]"},
			{data: "TLAMT", title: "[[#{HQP_L_BILLING_AMT}]]"},
			{data: "RETAMT", title: "[[#{HQP_L_RETURN_AMT}]]"},
			{data: "CHAMT", title: "[[#{HQP_L_EXPECTED_PAYMENT_AMT}]]"},
			{data: "TOTAL", title: "[[#{HQP_L_DEPOSIT_AMT}]]"},
			{data: "ARREAR", title: "[[#{HQP_L_BALANCE}]]"}
		],
		columnDefs: [
			{targets: [0, 1], className: "dt-body-center"},
			{targets: [2, 3, 4, 5, 6], className: "dt-body-right"}
		],
		rowCallback: function(row, data, index) {
			if (index == 0)
			{
				$(row).find("td").addClass("summary");
			};
		},		
		ajax: {
			url: "[[${BASE_PATH}]]/accounts/ap/list/data",
			dataSrc: function(response) 
			{				
				let data = response.RESULT;
				
				let list = data.list;
				let summary = data.summary;
				
				$("#SUMMARY_1").text(summary.CREDAMT);
				$("#SUMMARY_2").text(summary.DUEAMT);
				$("#SUMMARY_3").text(summary.CURAMT);
				$("#SUMMARY_4").text(summary.PROAMT);
				$("#SUMMARY_5").text(summary.BALAMT);
				
				let length = list.length;
				
				for (let i=0; i < length; i++)
				{
					list[i].CRDAT = JpUtilsString.defaultString(list[i].CRDAT, "[[#{HQP_L_ORDER_IN_PROGRESS}]]");
				};
				
				let rows = (length > 0) ? length-1 : 0;
				
				$("#totalRows").html(JpUtilsNumber.addComma(rows) + " row(s).");
				
				return list;
			}			
		},
		initComplete:function(settings, json) 
		{			
			ProgressBar.hide();
		}
	});
	
	// Datatable grid 초기 설정 셋업
	initGridTable($tableObj);
});

$("#BTN_search").on("click", function(){		
	doSearch(); 
});

function doSearch()
{
	$tableObj.ajax.reload();
}
</script>	
</th:block>