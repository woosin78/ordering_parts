<!DOCTYPE html>
<html
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{portal/layout/iv/hq/parts/common/index}">
<th:block layout:fragment="content">
	<div class="block-header">
		<div class="block-title" th:text="#{HQP_T_INVOICE_STATUS}"></div><!-- Invoice Status -->	
		<div class="block-button-area">		
			<button id="BTN_search" type="button" th:text="#{HQP_B_SEARCH}"></button><!-- Search -->
		</div>
	</div>
	<div class="condition-area">
	<form id="FORM_search" name="FORM_search">
	<table class="condition">
		<tbody>
			<tr>
				<th th:text="#{HQP_L_PERIOD}"></th>
				<td colspan="3">
					<div class="input-area">
						<input type="text" id="pFromDate" name="pFromDate" class="custom-ui-calendar" th:value="${pFromDate}">
						<input type="text" id="pToDate" name="pToDate" class="custom-ui-calendar to" th:value="${pToDate}">
					</div>
				</td>
			</tr>	
		</tbody>
	</table>
	</form>
	</div>
	<div class="split-row"></div>
	<div class="grid-info">
		<div class="grid-total">
			<div class="split"></div>
			<span class="total-number" id="totalRows"></span>
		</div>
	</div>
	
	<div id="AREA_grid" class="flex-grow grid-area">
		<table id="TBL_grid" class="order-column stripe compact"></table>
	</div>
<script>
let $tableObj;
let columns = [];
let data = [];

$(function(){
	Calendar.makeBeetweenCalendar($("#pFromDate"), "[[${pFromDate}]]", $("#pToDate"), "[[${pToDate}]]");
	
	$tableObj = $("#TBL_grid").DataTable({
		select: {
			selector: "td:not(.noselect)"// noselect class 컬럼은 select 하지 않도록 한다. (input과 충돌 발생)
	    },
		ordering: true,// 정렬 기능 켬
		scrollY: 100,
		//fixedColumns: {leftColumns: 5},
		columns : columns,
		/*
		columnDefs: [
			{targets: [0], className: "skip-download dt-body-center"},
			{targets: [1], className: "link dt-body-center"},
			{targets: [4, 5, 6, 10, 12, 13, 14, 15], className: "dt-body-center"},
			{targets: [11], className: "dt-body-right"}
		],		
		ajax: {
			url: "[[${BASE_PATH}]]/report/order/machine/list/data",
			data: function(p)
			{
				p.pFromDate = $("#pFromDate").val();
				p.pToDate = $("#pToDate").val();
			},
			dataSrc: function(response) 
			{
				let data = response.RESULT;

				$("#totalRows").html(JpUtilsNumber.addComma(data.length) + " row(s).");

				return data;
			}
		},
		*/
		initComplete:function(settings, json) 
		{			
			ProgressBar.hide();
		}
	});

	// Datatable grid 초기 설정 셋업
	initGridTable($tableObj);
});

//Search 버튼 클릭
$("#BTN_search").on("click", function(){		
	doSearch(); 
});

function doSearch()
{
	columns = [];
	data = [];
	
	JpUtilsAjax.get({
		url: "[[${BASE_PATH}]]/report/order/machine/list/data",		
		data: {"pFromDate": $("#pFromDate").val(), "pToDate": $("#pToDate").val()},
		success: function(response, textStatus, jqXHR)
		{
			let data = response.RESULT;
			
			alert(data.keys().length);
			
			$.each(data, function(index, item) {
				//columns.push({data: "ZFCIVNO", title: "[[#{HQP_L_INVOICE_NO}]]"});
				//alert(item);
			});
			
			//columnDefs.push({targets: [0], className: "skip-download dt-body-center"});
			
		},
		complete: function(jqXHR, textStatus)
		{
		}
	});	
	
	//$tableObj.ajax.reload();
};
</script>
</th:block>