<!DOCTYPE html>
<html
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
	<script th:inline="javascript">
	/* Set up static values */
	const GLOBAL_CONST = {};
	
	/*[# th:each="variable: ${globalConstVariables}" ]*/
	GLOBAL_CONST[ [[${variable.key}]] ] = [[${variable.value}]];
	/*[/]*/
	</script>

	<title th:text="#{PTL_T_DOOBIZ_PLUS}"></title>
	<!-- Meta -->
	<th:block th:replace="portal/layout/iv/hq/parts/common/fragments/meta"></th:block>
	<!-- CSS -->
	
	<link rel="stylesheet" type="text/css" th:href="@{/portal/css/jquery/jquery.bxslider.css}">
	<link rel="stylesheet" type="text/css" th:href="@{/portal/css/layout/iv/hq/parts/main.css}">
	<link rel="stylesheet" type="text/css" th:href="@{/portal/css/layout/iv/hq/parts/gnb.css}">	
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fomantic-ui/2.8.8/semantic.min.css"/>
	
	<!-- JavaScript -->
	<th:block th:replace="portal/layout/iv/hq/parts/common/fragments/js"></th:block>
	
	<!-- 배너관련 파일 -->
	<link rel="stylesheet" type="text/css" href="/portal/slick/slick.css"/>
	<link rel="stylesheet" type="text/css" href="/portal/slick/slick-theme.css"/>
	<script type="text/javascript" src="/portal/slick/slick.min.js"></script>
	
</head>
<body>
	<!-- Progress bar end -->
	<div class="wrap">
		<div style="position:absolute"><script>document.write("<img id='mainImg' src='" + "[[@{/portal/img/main}]]/main" + (Math.floor(Math.random()*4)+1) + "_.png'/>");</script></div>
		<div class="body-area">			
			<div class="main-back-img">				
				<div class="intro-area">
					<div class="app-name">DOOBIZ</div>
					<div class="vision">Global Leader Doosan</div>
					<div class="description">
						Doosan is preparing for the future for the better life of mankind<br />all over the world.
					</div>
					<button id="BTN_goOrder" class="order-button">
						<span th:text="#{HQP_B_ORDER}"></span>
					</button>
				</div>
			</div>
			
			<!-- header.jsp begin -->
			<div class="gnb-area">
				<div class="top-header">
					<div class="logo-area">
						<img class="logo-doosan" th:src="@{/portal/img/logo/logo.png}" /><img class="logo-doobizplus" th:src="@{/portal/img/logo/doobizplus.png}" alt="DOOBIZ Plus" />
					</div>
					<div class="info-area">
						<ul class="info-list">
							<li class="username" sec:authentication="name"></li>
							<li>|</li>
							<li class="new-window" th:text="#{PTL_T_NEW_WINDOW}"></li>
							<li>|</li>
							<li class="dealer-info" th:text="#{PTL_T_DEALER_INFO}"></li>
							<li>|</li>
							<li class="tooltip">[[#{PTL_T_LAST_LOGIN_INFO}]]<span class="last-login-time tooltiptext"></span></li>
						</ul>
						<div class="split"></div>
						<button class="logout-button" type="button" th:text="#{PTL_B_LOGOUT}"></button>
					</div>
				</div>
				<div class="gnb-wrap">
					<div class="gnb-container">
						<div class="gnb-menu-area">				
							<ul class="gnb-menu-list2" style="display:none;"></ul>	
							<ul class="gnb-menu-sub-list"></ul>
						</div>
					</div>
				</div>				
				<div class="bulletin-area">
					<div class="bulletin-sub-area">
						<table>
							<colgroup>
								<col width="50%">
								<col width="50%">
							</colgroup>
							<tr>
								<td>
									<table class="bulletin-1">
									<th:block th:if="${#lists.isEmpty(bbs1)}">
										<tr>
											<td rowspan="4" class="bbs-name"><div class="bulletin-title-text" th:text="${bbs1Name}" th:title="${bbs1Name}"></div><img src="/portal/img/icon/more.png" onclick="goToBoard(1);" style="cursor: pointer; margin-top: 20px;"/></td>
											<td class="bbs-title">・[[#{HQP_T_EMPTY_RESULT}]]</td>
											<td class="bbs-date">&nbsp;</td>
										</tr>
										<tr th:each="i: ${#numbers.sequence(1, 3)}">
											<td class="bbs-title">&nbsp;</td>
											<td class="bbs-date">&nbsp;</td>
										</tr>
									</th:block>
									<th:block th:unless="${#lists.isEmpty(bbs1)}">
										<tr th:each="content, i: ${bbs1}">
											<td rowspan="4" class="bbs-name" th:if="${i.index == 0}"><div class="bulletin-title-text" th:text="${bbs1Name}" th:title="${bbs1Name}"></div><img src="/portal/img/icon/more.png" onclick="goToBoard(1);" style="cursor: pointer; margin-top: 20px;"/></td>
											<td class="bbs-title">・<a class="link" th:data-key="${content.bcSeq}" th:bSeq="${content.bSeq}">[[${content.title}]]</a></td>
											<td class="bbs-date" th:text="${content.displayRegDate2}"></td>												
										</tr>
										<tr th:if="${#lists.size(bbs1) < 4}" th:each="i: ${#numbers.sequence(0, #lists.size(bbs1)-4)}">
											<td colspan="2">&nbsp;</td>
										</tr>											
									</th:block>
									</table>
								</td>
								<td>
									<table class="bulletin-2">
									<th:block th:if="${#lists.isEmpty(bbs2)}">
										<tr>
											<td rowspan="4" class="bbs-name"><div class="bulletin-title-text" th:text="${bbs2Name}" th:title="${bbs2Name}"></div><img src="/portal/img/icon/more.png" onclick="goToBoard(2);" style="cursor: pointer; margin-top: 20px;"/></td>
											<td class="bbs-title">・[[#{HQP_T_EMPTY_RESULT}]]</td>
											<td class="bbs-date">&nbsp;</td>
										</tr>
										<tr th:each="i: ${#numbers.sequence(1, 3)}">
											<td class="bbs-title">&nbsp;</td>
											<td class="bbs-date">&nbsp;</td>
										</tr>
									</th:block>
									<th:block th:unless="${#lists.isEmpty(bbs2)}">
										<tr th:each="content, i: ${bbs2}">
											<td rowspan="4" class="bbs-name" th:if="${i.index == 0}"><div class="bulletin-title-text" th:text="${bbs2Name}" th:title="${bbs2Name}"></div><img src="/portal/img/icon/more.png" onclick="goToBoard(2);" style="cursor: pointer; margin-top: 20px;"/></td>
											<td class="bbs-title">・<a class="link" th:data-key="${content.bcSeq}" th:bSeq="${content.bSeq}">[[${content.title}]]</a></td>
											<td class="bbs-date" th:text="${content.displayRegDate2}"></td>												
										</tr>
										<tr th:if="${#lists.size(bbs2) < 4}" th:each="i: ${#numbers.sequence(0, #lists.size(bbs2)-4)}">
											<td colspan="2">&nbsp;</td>
										</tr>											
									</th:block>
									</table>
								</td>
							</tr>
						</table>
					</div>
				</div>
			</div>
		</div>

		<div class="bottom-area">
			<div class="copy-right">
				<span th:text="#{PTL_T_COPY_RIGHT}"></span>
			</div>
		</div>
	</div>
	<!-- Logout -->
	<form id="FORM_logout" method="post" th:action="@{${T(org.jwebppy.portal.common.PortalConfigVo).FORM_LOGOUT_PROCESSING_URL}}"></form>	
	<!-- iframe th:src="|${BASE_PATH}/preload|" style="display:none;"></iframe -->

	<!-- 프로모션 배너 -->
	<div id="promotionBanner" class="banner-div1"> <!-- background-color: skyblue; -->
		<form id="FORM_promotionOrder" method="post" th:action="@{/portal/iv/hq/parts/domestic/order/create/gate/promotion}"></form>
	    <div id="slider-div" class="slick"></div>
	</div>
	<!-- 프로모션 배너 -->
<script>
$(window).on("load", function() {
	ProgressBar.hide();
	
	Promotion.getPromotionBanner();
	stickyPromotionBanner();

	Survey.getLatestSurvey();
});

$(window).resize($.debounce(100, function(e){
	resizeView();
	stickyPromotionBanner();
}));

let Promotion = {
	getPromotionBanner: function() {
		// 진행중인 프로모션 배너 목록 가져오기
		JpUtilsAjax.get({
			url: "/portal/iv/hq/parts/promotion/list/banner",
			global: false,
			success: function(data, textStatus, jqXHR)
			{
				let result = data.RESULT;
				
				if(0==result.length)
				{
					$('#promotionBanner').css('display', 'none');
					return;
				}
				
				$.each(result, function(index, element) {
					$('#slider-div').append('<a href="javascript:Promotion.popupView('+element.pseq+', '+element.width+', '+element.height+')"><img class="slick-img" src="/portal/iv/image/load?ulfSeq=' + element.uploadFileLists[0].uflSeq + '"></a>');
				});
				
				// 슬라이더 옵션 셜정
				$('#slider-div').slick({
					slide: 'a'		//슬라이드 되어야 할 태그 ex) div, li, a 등
					,infinite : true 	//무한 반복 옵션	 
					,slidesToShow : 1		// 한 화면에 보여질 컨텐츠 개수
					,slidesToScroll : 1		//스크롤 한번에 움직일 컨텐츠 개수
					,speed : 1000	 	// 다음 버튼 누르고 다음 화면 뜨는데까지 걸리는 시간(ms)
					,arrows : true 		// 옆으로 이동하는 화살표 표시 여부
					//,dots : true 		// 스크롤바 아래 점으로 페이지네이션 여부
					,autoplay : true		// 자동 스크롤 사용 여부
					,autoplaySpeed : 3000 	// 자동 스크롤 시 다음으로 넘어가는데 걸리는 시간 (ms)
					,pauseOnHover : true	// 슬라이드 이동	시 마우스 호버하면 슬라이더 멈추게 설정
					,vertical : false		// 세로 방향 슬라이드 옵션
					//,prevArrow : "<button type='button' class='slick-prev'>Previous</button>"	// 이전 화살표 모양 설정
					//,nextArrow : "<button type='button' class='slick-next'>Next</button>"		// 다음 화살표 모양 설정
					//,dotsClass : "slick-dots2" 	//아래 나오는 페이지네이션(점) css class 지정
				});
			}
		});	
	},
	popupView: function(pSeq, width, height) {
		let url = "/portal/iv/hq/parts/promotion/popup/view?pSeq=" + pSeq;
		
		width = JpUtilsString.defaultString(width, "700");
		height = JpUtilsString.defaultString(height, "600");
		
		Popup.open(url, width, height, "Y", "Y");
	},
	order: function(materialNos) {
		let html = [];

		$.each(materialNos, function(index, value) {
			html.push("<input type='hidden' name='materialNo' value='" + value + "' />");
		});
		
		ProgressBar.show();
		
		$("#FORM_promotionOrder").append(html.join("")).submit();
	}
};

let Survey = {
	sSeq: 0,
	getLatestSurvey: function() {
		let options = {
			url: "/portal/iv/survey/latest",
			data: {},
			success: function(data) {
				let survey = data.RESULT;
				if (survey == null) return;
				
				JpUiDimmer.confirm("[" + survey.title + "] [[#{HQP_M_RESPOND_SURVERY}]]", function() {
					Survey.sSeq = survey.sseq;
					Survey.popupVote();
				});
			},
			error: function(jqXHR, textStatus, errorThrown) {
				console.log(textStatus);
				console.log(errorThrown);
			}
		};
		
		JpUtilsAjax.post(options);
	},
	popupVote: function() {
		if (this.sSeq == 0) {
			return;
		}
		Popup.open("/portal/iv/survey/popup/vote?sSeq="+this.sSeq, 700, 700);
	},
};

function callbackAfterVote()
{
	document.location.href = "/portal/iv/survey/list";
};

$(function(){
	resizeView();

	//상단 메뉴 생성 공통함수
	makeGnb();
	
	$(".top-header .logo-doobizplus").on("click", function() {
		goHome()
	});
	
	$(".top-header li.new-window").on("click", function() {
		window.open("/portal/forward/entry_point", "");
	});
	
	$(".top-header li.dealer-info").on("click", function() {
		clickDealerInfo();
	});
	
	$(".top-header li.username").on("click", function() {
		clickUserInfo();
	});
	
	$(".top-header .logout-button").on("click", function() {
		clickLogout();	    		
	});	

	$("#BTN_goOrder").on("click", function() {
		document.location.href = "[[${BASE_PATH}]]/order/create/write";
	});
	
	//Get last login information
	JpUtilsAjax.get({
		url: "/platform/mgmt/user/login/history/last_login_info",		
	    success: function(response, textStatus, jqXHR) 
	    {
	    	let data = response.RESULT;
	    	
	    	if (data != null && JpUtilsString.isNotEmpty(data.regDate))
	    	{
	    		$(".last-login-time").html(data.displayRegDate + "/" + data.ip);
	    	}
	    	else
	    	{
	    		$(".last-login-time").html("-/-");
	    	};	    	
	    }	
	});
	
	//Popup
	JpUtilsAjax.get({
		url: "/portal/iv/board/popup/list/data",
		global: false,
		success: function(data, textStatus, jqXHR)
		{
			let result = data.RESULT;
			let settings = {
				width: 700,
				height: 600,
				left: 0,
				top: 0,
				fgScrollbars: "Y"
			};
			
			let left = 0;
			let top = 0;
			let screenWidth = screen.availWidth;
			
			$.each(result.reverse(), function(index, element) {
				let fgNotShow = JpUtilsString.defaultString($.cookie(element.bcSeq), "N");
				
				if (JpUtilsString.equals(fgNotShow, "N"))
				{
					let width = JpUtilsNumber.defaultNumber(parseInt(element.width), 700);
					let height = JpUtilsNumber.defaultNumber(parseInt(element.height), 600);

					if (screenWidth < left + width)
					{
						left = 0;
						top += 150;
						
						totalWidth = 0;
					};

					let settings = {
						url: "/portal/iv/board/popup/view2?bSeq=" + element.bseq + "&bcSeq=" + element.bcSeq + "&fgFrom=M",
						name: "popup_" + element.bcSeq,
						width: width,
						height: height,
						left: left,
						top: top,
						fgCenter: "N",
						fgScrollbars: "Y"
					};
					
					JpUiPopup.open(settings);
					
					left += width;
				};
			});
		}
	});	
	
	checkExpiredPassword();
});

function goHome()
{
	document.location.href = "/portal/forward/entry_point";
};

function clickUserInfo()
{
	Popup.open("/portal/iv/user/write", 700, 300);
};

function clickDealerInfo()
{
	Popup.open("[[${BASE_PATH}]]/dealer_info/view", 1100, 800);
};

function clickLogout()
{
	$("#FORM_logout").submit();
};

function goToBoard(type)
{
	let bSeq = (type == 1) ? "[[${bSeq1}]]": "[[${bSeq2}]]";
	
	location.href = "/portal/iv/board/list?bSeq=" + bSeq;	
};

$(".bulletin-area a.link").on("click", function() {
	let url = "/portal/iv/board/popup/view?bSeq=" + $(this).attr("bSeq") + "&bcSeq=" + $(this).attr("data-key") + "&fgFrom=M";
	Popup.open(url, 1024, 730, "Y", "Y");
});

function checkExpiredPassword()
{
	JpUtilsAjax.get({
		url: "/platform/mgmt/user/check/expired_password",
		global: false,
		success: function(data, textStatus, jqXHR)
		{
			let result = data.RESULT;
			
			let difference = parseInt(result.difference);
			
			if (difference < 15)
			{
				if (difference < 0)
				{
					JpUiDimmer.alert("[[#{PLTF_M_PASSWORD_EXPIRED}]]", function() {
						document.location.href = "[[${T(org.jwebppy.portal.common.PortalConfigVo).FORM_PASSWORD_CHANGE_PAGE_URL}]]";
					});
				}
				else
				{
					let message = "[[#{PLTF_M_PASSWORD_EXPIRE_DATE_NOTICE}]]".replace("{0}", result.expiredDate);
					
					JpUiDimmer.confirm(message, function() {
						document.location.href = "[[${T(org.jwebppy.portal.common.PortalConfigVo).FORM_PASSWORD_CHANGE_PAGE_URL}]]";
					});					
				};
			};
		}
	});
};

let RESIZING_MIN_WIDTH = 1280;
let RESIZING_MIN_HEIGHT = 720;

function resizeView()
{
	let width = $(window).width();
	let height = $(window).height();
	
	if (width > RESIZING_MIN_WIDTH)
	{
		$("#mainImg").width(width);
		
		if (height > RESIZING_MIN_HEIGHT)
		{
			$("#mainImg").height(height);
		}
		else
		{
			$("#mainImg").height(height);
		};
	}
	else
	{
		$("#mainImg").width(RESIZING_MIN_WIDTH);
		$("#mainImg").height(RESIZING_MIN_HEIGHT);
	}
};

function stickyPromotionBanner()
{
	let width = $(window).width();
	
	if (width > RESIZING_MIN_WIDTH)
	{
		$("#promotionBanner").removeClass("banner-div2").addClass("banner-div1");
	}
	else
	{
		$("#promotionBanner").removeClass("banner-div1").addClass("banner-div2");
	};
};
</script>
</body>
</html>