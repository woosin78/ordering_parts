<!DOCTYPE html>
<html
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{portal/layout/iv/hq/parts/popup/index}">


<th:block layout:fragment="content">
	<div class="block-header">
		<div class="block-title" th:text="#{HQP_T_ORDER_LIST}"></div>
		<div class="block-button-area">
			<button id="BTN_select" type="button" th:text="#{HQP_B_SELECT}"></button><!-- Select -->
			<button id="BTN_search" type="button" th:text="#{HQP_B_SEARCH}"></button><!-- Search -->
		</div>
	</div>
	
	<div class="condition-area">
	<form id="FORM_search" name="FORM_search">
	<table class="condition">
		<tbody>
			<tr>
				<th th:text="#{HQP_L_ORDER_NO}"></th>
				<td>
					<div class="input-area">
						<input type="text" id="pOrderNo" name="pOrderNo" class="custom-ui" th:value="${pOrderNo}">
					</div>
				</td>
				<th th:text="#{HQP_L_PO_NO}"></th>
				<td>
					<div class="input-area">
						<input type="text" id="pPoNo" name="pPoNo" class="custom-ui" th:value="${pPoNo}">
					</div>
				</td>
				<th th:text="#{HQP_L_PART_NO}"></th>
				<td>
					<div class="input-area">
						<input type="text" id="pPartNo" name="pPartNo" class="custom-ui" th:value="${pPartNo}">
					</div>
				</td>				
			</tr>
			<tr>
				<th th:text="#{HQP_L_ORDER_DATE}"></th>
				<td colspan="5">
					<div class="input-area">
						<input type="text" id="pFromDate" name="pFromDate" class="custom-ui-calendar" th:value="${pFromDate}">
						<input type="text" id="pToDate" name="pToDate" class="custom-ui-calendar to" th:value="${pToDate}">
					</div>
				</td>
			</tr>
		</tbody>
	</table>
	</form>
	</div>
	<div class="split-row"></div>
	
	<div id="AREA_grid" class="flex-grow grid-area">
		<table id="TBL_grid" class="order-column stripe compact"></table>
	</div>
<script>
$(document).ready(function() {
	_setPartAutocomplete($("#pPartNo"));
});

$(function(){
	Calendar.makeBeetweenCalendar($("#pFromDate"), "[[${pFromDate}]]", $("#pToDate"), "[[${pToDate}]]");
	
	$tableObj = $("#TBL_grid").DataTable({
		select: {
			selector: "td:not(.noselect)"// noselect class 컬럼은 select 하지 않도록 한다. (input과 충돌 발생)
	    },
		ordering: true,// 정렬 기능 켬
		scrollY: 100,
		columns : [
			{// 컬럼에 checkbox 설정
				name: "chk",
				orderable: false,// checkbox 는 정렬 불가
				title:"<input type='checkbox' class='custom-ui check-all' onchange='syncInput(this)' onclick='allChecked(this)'><label></label>",
				render: function(data, type, row)
				{
					return "<input type='checkbox' class='custom-ui check-all' onchange='syncInput(this)'><label></label>";// FixedColumns 사용시엔 syncInput 호출 필요함.
				}
			},
			{data: "VBELN", title: "[[#{HQP_L_ORDER_NO}]]"},
			{data: "POSNR", title: "[[#{HQP_L_LINE_ITEM}]]"},
			{data: "BSTKD", title: "[[#{HQP_L_PO_NO}]]"},
			{data: "MATNR", title: "[[#{HQP_L_SUPPLY_PART_NO}]]"},
			{data: "MAKTX", title: "[[#{HQP_L_DESCRIPTION}]]"},
			{data: "KWMENG", title: "[[#{HQP_L_REQ_QTY}]]"},
			{data: "ERDAT", title: "[[#{HQP_L_ORDER_DATE}]]"}
		],
		columnDefs: [
			{targets: [0, 1, 2, 3, 6, 7], className: "dt-body-center"}
		],
		ajax: {
			url: "[[${BASE_PATH}]]/claim/create/reference/order/list/data",
			data: function(p)
			{
				// ajax로 넘길 파라미터
				p.pOrderNo = $("#pOrderNo").val();
				p.pPoNo = $("#pPoNo").val();
				p.pPartNo = $("#pPartNo").val();
				p.pFromDate = $("#pFromDate").val();
				p.pToDate = $("#pToDate").val();
			},
			dataSrc: function(response)
			{
				let result = response.RESULT;

				return result;
			},
		},	    		
		initComplete: function() {
			ProgressBar.hide();
		}	    		
	});
	
	// Datatable grid 초기 설정 셋업
	initGridTable($tableObj);
	
	$("#BTN_search").on("click", function() {
		doSearch();
	});
	
	//Input text 엔터 키 입력
	$("#FORM_search input:text").on("keydown", function(event) {
		if (event.keyCode == 13)
		{
			doSearch();
		};
	});	
	
	function doSearch()
	{
		$tableObj.ajax.reload();
	};

	$("#BTN_select").on("click", function() {
		let tds = $tableObj.columns(0).nodes()[0];
	
		let selectedItems = [];
		
		for (let i=0,length=tds.length; i<length; i++)
		{
			let $td = $(tds[i]);
	
			if ($td.find("input:checkbox").is(":checked"))
			{
				selectedItems.push($tableObj.row($td).data());
			};
		};

		try
		{
			opener.setSelectedItems(selectedItems);	
		}
		catch (e) {}
	});
});
</script>
</th:block>