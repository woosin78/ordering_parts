<!DOCTYPE html>
<html
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{portal/layout/iv/eu/parts/common/index}">
<th:block layout:fragment="content">

<style>
.ui-menu-item .ui-menu-item-wrapper.ui-state-active {
    background: #B2E4D7 !important;
    font-weight: bold !important;
    color: #000 !important;
} 

#CertifiedProgram:hover {
	cursor: pointer;
	text-decoration: underline;
}

</style>

	<div class="block-header">
		<div class="block-title" th:text="#{EUP_T_0078}"></div><!-- Parts Info. -->
		<div class="block-button-area">
			<button id="BTN_search" type="button" th:text="#{EUP_B_0002}"></button><!-- Search -->	
		</div>
	</div>
	<form id="FORM_search" name="FORM_search" onsubmit="return false;">
	<div class="condition-area">
		<table class="condition table-fixed">
			<tbody>
				<tr>
					<th style="width:200px" th:text="#{EUP_L_0102}"></th><!--Parts No.  -->
					<td> 			
						<div class="input-area">
							<input type="text" id="pPartsNo" name="pPartsNo" class="custom-ui-btn" style="text-transform: uppercase;" tabindex="1">
							<input type="hidden" id="pPlant">
							<button class="btn-popup2" type="button" onclick="searchParts();"></button>					
						</div>
					</td>
					<th style="width:200px" th:text="#{EUP_L_0144}"></th><!-- Req Qty -->
					<td>
						<div class="input-area">
						<input type="text" id="pReqQty" name="pReqQty" class="custom-ui" tabindex="2">
						</div>							
					</td>			
				</tr>		
			</tbody>
		</table>
	</div>
	</form>
	<div class="split-row"></div>
	<div class="condition-area">
		<table class="condition table-fixed">
			<tbody>
				<tr>
					<th style="width:200px" th:text="#{EUP_L_0145}"></th><!-- Part No Desc -->
					<td id="MAKTX"></td>
					<th style="width:200px" th:text="#{EUP_L_0146}"></th><!-- Stock -->
					<td id="AVA_FLAG"></td>			
				</tr>		
				<tr>
					<th th:text="#{EUP_L_0101}"></th><!--Serviceable  -->
					<td id="SVRCD"></td>
					<th th:text="#{EUP_L_0147}"></th><!--Not Service Reason  -->
					<td>
						<span id="NOT_SERVICE"></span>
						
						<span id="AREA_notServReason" style="display:none;">
							<button id="BTN_notServReason" class="btn-popup2" type="button" onclick="showMoreInfoPop(this);"></button>
						</span>
					</td>			
				</tr>		
				<tr>
					<th th:text="#{EUP_L_0050}"></th><!--Sales Lot  -->
					<td id="AUMNG"></td>
					<th th:text="#{EUP_L_0148}"></th><!--Model  -->
					<td>						
						<div id="AREA_appliedModel" style="display:none;">
						<span id="M_MATNR" class="custom-ui"></span>
						<button id="BTN_appliedModel" class="btn-popup2" type="button" onclick="showMoreInfoPop(this);"></button>
						</div>								
					</td>			
				</tr>			
				<tr>
					<th th:text="#{EUP_L_0149}"></th><!--Product Hierarchy  -->
					<td id="PRODH_T"></td>
					<th th:text="#{EUP_L_0150}"></th><!--Open Qty  -->
					<td id="KWMENG"></td>			
				</tr>	
				<tr>
					<th th:text="#{EUP_L_0151}"></th><!--Net Weight  -->
					<td id="NTGEW"></td>
					<th th:text="#{EUP_L_0152}"></th><!-- List Price Cost Code -->
					<td id="KONDM"></td>			
				</tr>
				<tr>
					<th th:text="#{EUP_L_0153}"></th><!-- Supply Part Number -->
					<td>			
						<div id="AREA_subItem" style="display:none;">			
						<span id="REPNR" class="custom-ui"></span>
						<button id="BTN_subItem" class="btn-popup2" type="button" onclick="showMoreInfoPop(this);"></button>
						</div>								
					</td>
					<th th:text="#{EUP_L_0154}"></th><!-- Stock of Supply Part -->
					<td id="STOCKP"></td>			
				</tr>
				<tr>
					<th>Certified Program</th><!-- Certified Program -->
					<td colspan="3">				
						<div id="CertifiedProgram_subItem" style="display:none;">			
						<span id="CertifiedProgram" class="custom-ui"></span>
						<button id="BTN_amItem" class="btn-popup2" type="button" onclick="showMoreInfoPop(this);"></button>
						</div>								
					</td>
				</tr>
			</tbody>
		</table>	
	</div>
	<div class="split-row"></div>
	<div class="condition-area flex-grow">
		<table class="condition">
		     <tbody>
				<tr>
					<th style="text-align:center;" rowspan="2" th:text="#{EUP_L_0033}"></th><!--List Price  -->
					<th style="text-align:center;" colspan="2" th:text="#{EUP_L_0034}"></th><!--Net Price  -->			
				</tr>		
		        <tr>
		            <th style="text-align:center;" th:text="#{EUP_L_0155}"></th><!--Stock Order  -->
		            <th style="text-align:center;" th:text="#{EUP_L_0156}"></th><!--Emergency Order  -->                        
		        </tr>
				<tr>
					<td id="LPRICE" class="right"></td>
					<td id="YUSO" class="right"></td>
					<td id="YUEO" class="right"></td>						
				</tr> 
			</tbody>        
		</table>	
	</div>
<script type="application/javascript">
$(document).ready(function() {
	ProgressBar.hide();	
});

function doSearch()
{
	if (JpUtilsString.isEmpty($("#pPartsNo").val()))
	{
		alert("[[#{EUP_M_0038}]]");
		return;
	}
	
	$("#pPartsNo").val($("#pPartsNo").val().toUpperCase());
	
	$.ajax({
		url: "[[${BASE_PATH}]]/info/part_info_list/data",
		data: {	"pPartsNo": $("#pPartsNo").val(), "pReqQty": $("#pReqQty").val() },
		beforeSend: function(jqXHR, settings)
		{
			ProgressBar.show();
		},		
	 	success: function(data, textStatus, jqXHR) 
    	{
	    	var result = data.RESULT;	    	
	    	var items = result.items;
	    	
	    	if (items.length == 0)
	    	{
	    		alert("[[#{EUP_M_0015}]]");
	    		document.location.reload();
	    	};
	    	
			$("#MAKTX").html(items[0].MAKTX);// Part No Desc
			$("#AVA_FLAG").html(items[0].STOCK);// Stock
			$("#SVRCD").html(items[0].SVRCD);// Serviceable
			
			var notcd = $.trim(items[0].NOTCD);
			$("#NOT_SERVICE").html("");
			
			if (notcd != "")
			{
				if (notcd == "MUL")
				{
					$("#AREA_notServReason").show();
				}
				else
				{
					$("#AREA_notServReason").hide();
				};
				
				$("#NOT_SERVICE").html(notcd + ":" + items[0].NOTCD_T);// Not Service Reason
			};
			
			var salesLot = $.trim(items[0].LFMNG);
			if (salesLot != "")
			{
				$("#AUMNG").html(salesLot + " " + items[0].MEINS);// Sales Lot	
			};
			
			var model = $.trim(items[0].MDLNM);
			$("#M_MATNR").html("");
			$("#AREA_appliedModel").hide();

			if (model != "")
			{
				$("#M_MATNR").html(model);// Model
				$("#AREA_appliedModel").show();
			};
			
			var openQty = $.trim(items[0].OPENQ);
			$("#KWMENG").html("");
			if (openQty != "")
			{
				$("#KWMENG").html(openQty + " " + items[0].MEINS);// Open Qty	
			};
			
			var supplyPartsNo = $.trim(items[0].SUPNR);
			$("#REPNR").html("");
			$("#AREA_subItem").hide();

			if (supplyPartsNo != "")
			{
				$("#REPNR").html(supplyPartsNo);// Supply Part Number
				$("#AREA_subItem").show();
			};
			
			var CertifiedProgram = $.trim(result.CertifiedProgram);
			$("#CertifiedProgram").html("");
			$("#CertifiedProgram_subItem").hide();

			if (CertifiedProgram != "")
			{
				$("#CertifiedProgram").html(CertifiedProgram);// Certified Program  (AM_PART_NO)
				$("#CertifiedProgram_subItem").show();
			};
			
			
			var leadMsg = $.trim(items[0].LEAD_MSG);
			if (leadMsg != "")
			{
				$("#STOCKP").html(items[0].STOCKP + " (" + leadMsg + ")");// Stock of Supply Part
				
				if (JpUtilsString.isNotEmpty(items[0].LEAD_EXTRA_MSG))
				{
					$("#STOCKP").append("<p style='color:red;'>" + items[0].LEAD_EXTRA_MSG + "</p>");
				};
			}
			else
			{
				$("#STOCKP").html(items[0].STOCKP);
			};
			
			var listPriceCostCode = $.trim(items[0].KONDM);
			$("#KONDM").html("");

			if (listPriceCostCode != "")
			{
				$("#KONDM").html(listPriceCostCode + " : " + items[0].KONDM_T);// List Price Cost Code	
			};
			
			$("#PRODH_T").html(items[0].PRODH_T+"  ["+items[0].PRODH+"]");// Product Hierarchy
			$("#NTGEW").html(items[0].NTGEW + " " + items[0].GEWEI);// Net Weight									
			$("#LPRICE").html(items[0].LPRICE+" "+items[0].WAERS);
			$("#YUSO").html(items[0].YUSO+" "+items[0].WAERS);
			$("#YUEO").html(items[0].YUEO+" "+items[0].WAERS);
			$("#pPlant").val(items[0].WERKS);
    	},
    	complete: function(jqXHR, textStatus)
    	{
    		ProgressBar.hide();
    	}    	
	});				
};

//Search 버튼 클릭
$("#BTN_search").on("click", function(){		
	doSearch(); 
});

// CertifiedProgram 클릭
$("#CertifiedProgram").on("click", function(){
	$("#pPartsNo").val($("#CertifiedProgram").text());
	doSearch(); 
});

$("#pPartsNo, #pReqQty").on("keydown", function(event) {	
	$("#pPartsNo").val($("#pPartsNo").val().toUpperCase());
	
	if (event.keyCode == 13)
	{
		if ($.trim($("#pPartsNo").val()) != "")
		{
			doSearch();
			$("#pPartsNo").autocomplete("close");
		};
	};
});

$("#pPartsNo").autocomplete({	
	source: function(request, response) {
		$.ajax({
			url: "[[${BASE_PATH}]]/info/autocompete/data",
			data: {	"pPartsNo": $("#pPartsNo").val() },			
			success: function(data, textStatus, jqXHR)
			{
				let result = data.RESULT;
				
				response(
						$.map(result.items, function(item) {
							if (JpUtilsString.isNotEmpty(item.MATERIAL_TEXT))
							{
								return {
									label: item.MATERIAL + " | " + item.MATERIAL_TEXT,
									value: item.MATERIAL
								}								
							};
						})
						);
			}
		});
	},	
	delay: 500,
	minLength: 4
});

/*
 * code(parts)변경 popup	 
 */ 	
function searchParts()
{
	Popup.open("[[${BASE_PATH}]]/info/parts_number_popup_list?pPartsNo=" + $("#pPartsNo").val(), 700, 600);
};

/**
 * 이미지 클릭시 대체품, Models applied by part, Controlling part 
 * 리스트 popup띄움
 */	
function showMoreInfoPop(obj)
{
	var id = obj.id;
	var width = 900;
	var height = 520;
	var url;
	var param = "?pPartsNo=" + $("#pPartsNo").val();
	
	if ($.trim($("#pPartsNo").val()).length > 0)
	{
		if ("BTN_subItem" == id)
		{
			url = "[[${BASE_PATH}]]/info/sub_item_popup_list";	
		}
		else if ("BTN_appliedModel" == id)
		{
			url = "[[${BASE_PATH}]]/info/applied_model_popup_list";
			width = 800;
		}
		else if ("BTN_notServReason" == id)
		{
			url = "[[${BASE_PATH}]]/info/alternative_popup_list";
			width = 700;
		}
		else if ("BTN_amItem" == id)
		{
			param = param + "&pPlant=" + $("#pPlant") .val();
			url = "[[${BASE_PATH}]]/info/am_part_popup_list";
			width = 700;
		}
		
		Popup.open(url + param, width, height);
	}
	else
	{
		  //display error message
		  $("#pPartsNo").focus();	
	}
}

function setPartsNo(partsNo)
{
	$("#pPartsNo").val(partsNo);
};
</script>
</th:block>
								